<div class="table-container">
  <div class="header-container">
    <h2 class="table-title">REPORTS FROM YOUR DISTRICT</h2>

    <!-- Search Input -->
    <div class="search-container">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search report</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Filter by street">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p style="margin-left: 15px;">Loading reports...</p>
  </div>

  <!-- Table Wrapper to Handle Scroll -->
  <div class="table-wrapper" *ngIf="!isLoading">
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 custom-table" @tableEnterAnimation>
    <!-- Space Column -->
    <ng-container matColumnDef="report_id">
      <th mat-header-cell *matHeaderCellDef>REPORT ID</th>
      <td mat-cell *matCellDef="let row">{{ row.report?.report_id || row.report_id }}</td>
    </ng-container>

    <ng-container matColumnDef="space_name">
      <th mat-header-cell *matHeaderCellDef>OPENSPACE</th>
      <td mat-cell *matCellDef="let row">{{ row.report?.space_name || row.space_name }}</td>
    </ng-container>

    <ng-container matColumnDef="street">
      <th mat-header-cell *matHeaderCellDef>STREET</th>
      <td mat-cell *matCellDef="let row">{{ row.report?.street || row.street }}</td>
    </ng-container>

    <ng-container matColumnDef="message">
      <th mat-header-cell *matHeaderCellDef>MESSAGE</th>
      <td mat-cell *matCellDef="let row">
        <span *ngIf="(row.message || row.report?.message) && (row.message || row.report?.message).trim(); else noMessage">
          {{ row.message || row.report?.message }}
        </span>
        <ng-template #noMessage>
          <span class="no-message-text">No message provided</span>
        </ng-template>
      </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>STATUS</th>
      <td mat-cell *matCellDef="let row">
        <span class="status-badge"
              [ngClass]="{
                'forwarded': row.forwarded_to_admin,
                'pending': !row.forwarded_to_admin
              }">
          {{ row.forwarded_to_admin ? 'Forwarded' : 'Pending' }}
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>ACTIONS</th>
      <td mat-cell *matCellDef="let row">
        <button
          mat-raised-button
          color="primary"
          (click)="forwardReport(row)"
          [disabled]="row.forwarded_to_admin"
          [title]="row.forwarded_to_admin ? 'Already forwarded to admin' : 'Forward to admin'">
          <mat-icon>forward</mat-icon>
          {{ row.forwarded_to_admin ? 'Forwarded' : 'Forward' }}
        </button>
        <button
          mat-raised-button
          color="accent"
          (click)="replyReport(row)"
          style="margin-left: 8px;">
          <mat-icon>reply</mat-icon>
          Reply
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" @rowAnimation></tr>
  </table>

  </div>
  <!-- Paginator -->
  <mat-paginator #paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
</div>
